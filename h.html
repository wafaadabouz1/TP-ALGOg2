<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Générateur de Graphe</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: linear-gradient(135deg, #d8b4fe, #a78bfa);
        font-family: "Segoe UI", sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 30px;
      }

      h1 {
        text-align: center;
        color: #4b0082;
        margin-bottom: 25px;
        font-size: 28px;
        font-weight: bold;
      }

      .main-container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 40px;
      }

      .container {
        width: 420px;
        background: #ffffff;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: 600;
        margin-top: 8px;
        color: #4b0082;
      }

      input,
      textarea,
      button,
      select {
        margin-top: 5px;
        padding: 10px;
        font-size: 15px;
        border: 2px solid #c4b5fd;
        border-radius: 8px;
        outline: none;
      }

      select {
        background-color: #f9f5ff;
        color: #4b0082;
        cursor: pointer;
      }

      button {
        margin-top: 15px;
        background-color: #8b5cf6;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
      }

      button:hover {
        background-color: #7c3aed;
      }

      .canvas-container {
        width: 600px;
        height: 500px;
        background: #ffffff;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      canvas {
        width: 100%;
        height: 100%;
        border: 2px dashed #c4b5fd;
        border-radius: 12px;
        background: #ffffff;
      }

      .rapport-btn {
        background-color: #7a3cff;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 20px;
      }

      .rapport-btn:hover {
        background-color: #a279ff;
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <h1>Générateur de Graphe</h1>
    <div class="main-container">
      <div class="container">
        <label>Type de graphe :</label>
        <select id="typeGraphe">
          <option value="non_oriente">Non orienté</option>
          <option value="oriente">Orienté</option>
          <option value="arbre">Arbre</option>
        </select>

        <label>Graphe pondéré ?</label>
        <select id="pondere">
          <option value="oui">Oui</option>
          <option value="non" selected>Non</option>
        </select>

        <label>Sommets (séparés par des virgules) :</label>
        <input id="sommets" placeholder="Ex: A,B,C,D" />

        <label>Matrice d’adjacence :</label>
        <textarea
          id="matrice"
          rows="5"
          placeholder="Ex:&#10;0 2 0 0&#10;0 0 3 0&#10;4 0 0 5&#10;0 0 0 0"
        ></textarea>

        <div class="buttons">
          <button onclick="exemple()">Exemple</button>
          <button onclick="dessinerGraphe()">Dessiner</button>
        </div>
      </div>

      <div class="canvas-container">
        <canvas id="graphCanvas" width="600" height="500"></canvas>
      </div>
    </div>

    <button onclick="window.location.href='rapport_tp1.pptx'" class="rapport-btn">
      Ouvrir le rapport
    </button>

    <script>
      function exemple() {
        document.getElementById("typeGraphe").value = "arbre";
        document.getElementById("pondere").value = "oui";
        document.getElementById("sommets").value = "A,B,C,D,E,F";
        document.getElementById("matrice").value =
          "0 1 1 0 0 0\n0 0 0 1 1 0\n0 0 0 0 0 1\n0 0 0 0 0 0\n0 0 0 0 0 0\n0 0 0 0 0 0";
      }

      function dessinerGraphe() {
        const canvas = document.getElementById("graphCanvas");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const type = document.getElementById("typeGraphe").value;
        const pondere = document.getElementById("pondere").value === "oui";
        const sommets = document
          .getElementById("sommets")
          .value.split(",")
          .map((s) => s.trim())
          .filter((s) => s !== "");

        if (sommets.length === 0) {
          alert("Veuillez entrer au moins un sommet !");
          return;
        }

        const matrice = document
          .getElementById("matrice")
          .value.trim()
          .split("\n")
          .map((row) => row.split(/\s+/).map(Number));

        const n = sommets.length;

        if (matrice.length !== n) {
          alert(`La matrice doit avoir ${n} lignes.`);
          return;
        }

        for (let i = 0; i < n; i++) {
          if (matrice[i].length !== n) {
            alert(`Ligne ${i + 1} ne contient pas ${n} valeurs.`);
            return;
          }
        }

        const rayon = 15;
        const positions = [];

        if (type === "arbre") {
          // Placement vertical compact pour arbre
          const levels = [];
          const visited = Array(n).fill(false);

          let racine = 0;
          const entrees = Array(n).fill(0);
          for (let i = 0; i < n; i++) {
            for (let j = 0; j < n; j++) {
              if (matrice[j][i] !== 0) entrees[i]++;
            }
          }
          racine = entrees.indexOf(0) !== -1 ? entrees.indexOf(0) : 0;

          const queue = [{ i: racine, level: 0 }];
          while (queue.length > 0) {
            const { i, level } = queue.shift();
            if (!levels[level]) levels[level] = [];
            levels[level].push(i);
            visited[i] = true;
            for (let j = 0; j < n; j++) {
              if (matrice[i][j] !== 0 && !visited[j]) {
                queue.push({ i: j, level: level + 1 });
              }
            }
          }

          const levelHeight = 80;
          const startY = 60;
          const centerX = canvas.width / 2;

          for (let l = 0; l < levels.length; l++) {
            const nodes = levels[l];
            const y = startY + l * levelHeight;
            const totalWidth = 100 * (nodes.length - 1);
            const startX = centerX - totalWidth / 2;

            for (let k = 0; k < nodes.length; k++) {
              const x = startX + k * 100;
              positions[nodes[k]] = { x, y };
            }
          }
        } else {
          // Graphe non orienté ou orienté → disposition circulaire
          const centerX = canvas.width / 2;
          const centerY = canvas.height / 2;
          const rayonCercle = 150;
          for (let i = 0; i < n; i++) {
            const angle = (2 * Math.PI * i) / n;
            const x = centerX + rayonCercle * Math.cos(angle);
            const y = centerY + rayonCercle * Math.sin(angle);
            positions.push({ x, y });
          }
        }

        ctx.strokeStyle = "#7c3aed";
        ctx.lineWidth = 2;
        ctx.font = "bold 14px Segoe UI";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        // --- Dessin des arêtes ---
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            if (matrice[i][j] !== 0) {
              const { x: x1, y: y1 } = positions[i];
              const { x: x2, y: y2 } = positions[j];

              ctx.beginPath();
              ctx.moveTo(x1, y1);
              ctx.lineTo(x2, y2);
              ctx.stroke();

              if (pondere) {
                const mx = (x1 + x2) / 2;
                const my = (y1 + y2) / 2;
                ctx.fillStyle = "#000";
                ctx.font = "bold 13px Segoe UI";
                ctx.fillText(matrice[i][j], mx, my - 5);
              }

              if (type === "oriente") {
                const angle = Math.atan2(y2 - y1, x2 - x1);
                const arrowLen = 10;
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(
                  x2 - arrowLen * Math.cos(angle - Math.PI / 6),
                  y2 - arrowLen * Math.sin(angle - Math.PI / 6)
                );
                ctx.lineTo(
                  x2 - arrowLen * Math.cos(angle + Math.PI / 6),
                  y2 - arrowLen * Math.sin(angle + Math.PI / 6)
                );
                ctx.closePath();
                ctx.fillStyle = "#7c3aed";
                ctx.fill();
              }
            }
          }
        }

        // --- Dessin des sommets ---
        for (let i = 0; i < n; i++) {
          const { x, y } = positions[i];
          ctx.beginPath();
          ctx.arc(x, y, rayon, 0, 2 * Math.PI);
          ctx.fillStyle = "#ede9fe";
          ctx.fill();
          ctx.strokeStyle = "#6d28d9";
          ctx.stroke();
          ctx.fillStyle = "#4c1d95";
          ctx.font = "bold 14px Segoe UI";
          ctx.fillText(sommets[i], x, y);
        }
      }
    </script>
  </body>
</html>
